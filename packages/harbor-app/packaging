set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

#Get the latest version of Harbor app
HARBOR_VERSION=`ls -r harbor/harbor-offline-installer-*.tgz | sed 's/harbor\/harbor-offline-installer-\(.*\)\.tgz/\1/' | head -1`

#Extract harbor package to the destination folder
echo "Extracting Harbor ${HARBOR_VERSION}..."
tar xzvf ${BOSH_COMPILE_TARGET}/harbor/harbor-offline-installer-${HARBOR_VERSION}.tgz
if [[ $? != 0 ]] ; then
  echo "Failed extracting Harbor ${HARBOR_VERSION}"
  exit 1
fi

#Copy the Harbor files to destination folder
cp -a ${BOSH_COMPILE_TARGET}/harbor/* ${BOSH_INSTALL_TARGET}/
chmod +x ${BOSH_INSTALL_TARGET}/*.sh
chmod +x ${BOSH_INSTALL_TARGET}/prepare

